<svg viewBox="0 0 1000 750" xmlns="http://www.w3.org/2000/svg">
  <!-- Fond et cadre -->
  <rect width="1000" height="750" fill="#f9fafb" rx="10" ry="10" stroke="#e5e7eb" stroke-width="2"/>
  <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1e40af">Architecture Détaillée du Système RAG</text>
  
  <!-- Section Interface Web -->
  <rect x="30" y="60" width="940" height="120" fill="#dbeafe" rx="8" ry="8" stroke="#3b82f6" stroke-width="2"/>
  <text x="500" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#1e40af">Interface Web (app.py + templates + static)</text>
  
  <!-- Composants de l'interface -->
  <rect x="60" y="100" width="200" height="60" fill="#ffffff" rx="4" ry="4" stroke="#3b82f6" stroke-width="1"/>
  <text x="160" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#1e40af">Formulaire de Saisie</text>
  <text x="160" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">(index.html, main.js)</text>
  
  <rect x="290" y="100" width="200" height="60" fill="#ffffff" rx="4" ry="4" stroke="#3b82f6" stroke-width="1"/>
  <text x="390" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#1e40af">Affichage des Messages</text>
  <text x="390" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">(main.js, formatMarkdown)</text>
  
  <rect x="520" y="100" width="200" height="60" fill="#ffffff" rx="4" ry="4" stroke="#3b82f6" stroke-width="1"/>
  <text x="620" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#1e40af">Panneaux Pliables</text>
  <text x="620" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">(Requêtes, Documents)</text>
  
  <rect x="750" y="100" width="200" height="60" fill="#ffffff" rx="4" ry="4" stroke="#3b82f6" stroke-width="1"/>
  <text x="850" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" fill="#1e40af">API REST</text>
  <text x="850" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">(/api/chat via app.py)</text>
  
  <!-- Section Moteur RAG -->
  <rect x="30" y="200" width="940" height="160" fill="#dcfce7" rx="8" ry="8" stroke="#10b981" stroke-width="2"/>
  <text x="500" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#047857">Moteur RAG (rag_chain.py)</text>
  
  <!-- Composants du moteur RAG -->
  <rect x="50" y="250" width="280" height="90" fill="#ffffff" rx="4" ry="4" stroke="#10b981" stroke-width="1"/>
  <text x="190" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#047857">Chaîne de Génération de Requêtes</text>
  <text x="190" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">_generate_queries = prompt | LLM | parser</text>
  <text x="190" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">Génère 5 variantes de la question</text>
  
  <rect x="350" y="250" width="280" height="90" fill="#ffffff" rx="4" ry="4" stroke="#10b981" stroke-width="1"/>
  <text x="490" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#047857">Chaîne de Récupération</text>
  <text x="490" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">_retrieval_chain = _generate_queries |</text>
  <text x="490" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">_retriever.map() | get_unique_union</text>
  
  <rect x="650" y="250" width="280" height="90" fill="#ffffff" rx="4" ry="4" stroke="#10b981" stroke-width="1"/>
  <text x="790" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#047857">Chaîne RAG Principale</text>
  <text x="790" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">_rag_chain = context + question | prompt |</text>
  <text x="790" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">LLM | StrOutputParser()</text>
  
  <!-- Section Système de Récupération -->
  <rect x="30" y="380" width="940" height="160" fill="#fae8ff" rx="8" ry="8" stroke="#a855f7" stroke-width="2"/>
  <text x="500" y="405" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#7e22ce">Système de Récupération (retriever.py)</text>
  
  <!-- Composants du système de récupération -->
  <rect x="50" y="430" width="260" height="90" fill="#ffffff" rx="4" ry="4" stroke="#a855f7" stroke-width="1"/>
  <text x="180" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7e22ce">Préparation des Documents</text>
  <text x="180" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">load_guides(), load_posts()</text>
  <text x="180" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">Charger et structurer les données</text>
  
  <rect x="330" y="430" width="340" height="90" fill="#ffffff" rx="4" ry="4" stroke="#a855f7" stroke-width="1"/>
  <text x="500" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7e22ce">Création et Indexation des Embeddings</text>
  <text x="500" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">index_data_embeddings(), RecursiveCharacterTextSplitter</text>
  <text x="500" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">HuggingFaceEmbeddings + FAISS.from_documents()</text>
  
  <rect x="690" y="430" width="260" height="90" fill="#ffffff" rx="4" ry="4" stroke="#a855f7" stroke-width="1"/>
  <text x="820" y="455" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7e22ce">Configuration du Retriever</text>
  <text x="820" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">vector_store.as_retriever()</text>
  <text x="820" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">similarity_score_threshold, k=2, seuil=0.3</text>
  
  <!-- Section Sources de Données -->
  <rect x="30" y="560" width="940" height="160" fill="#fee2e2" rx="8" ry="8" stroke="#ef4444" stroke-width="2"/>
  <text x="500" y="585" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#b91c1c">Sources de Données et API (api_client.py + scripts)</text>
  
  <!-- Composants des sources de données -->
  <rect x="50" y="610" width="260" height="90" fill="#ffffff" rx="4" ry="4" stroke="#ef4444" stroke-width="1"/>
  <text x="180" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#b91c1c">Posts Reddit</text>
  <text x="180" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">get_posts.py (API PRAW)</text>
  <text x="180" y="680" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">Posts + commentaires de r/techsupport</text>
  
  <rect x="330" y="610" width="260" height="90" fill="#ffffff" rx="4" ry="4" stroke="#ef4444" stroke-width="1"/>
  <text x="460" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#b91c1c">Guides iFixit</text>
  <text x="460" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">guides.py (API iFixit)</text>
  <text x="460" y="680" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">Collection des guides techniques</text>
  
  <rect x="610" y="610" width="340" height="90" fill="#ffffff" rx="4" ry="4" stroke="#ef4444" stroke-width="1"/>
  <text x="780" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#b91c1c">Client API pour les Étapes de Guides</text>
  <text x="780" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">get_guide_steps() dans api_client.py</text>
  <text x="780" y="680" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">Enrichissement des guides avec leurs étapes détaillées</text>
  
  <!-- Flèches de flux -->
  <!-- Interface Web vers Moteur RAG -->
  <path d="M500 180 L500 200" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Moteur RAG vers Système de Récupération -->
  <path d="M500 360 L500 380" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Flux bidirectionnel entre Système de Récupération et Sources de Données -->
  <path d="M470 540 L470 560" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M530 560 L530 540" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Flux de données horizontaux dans le Moteur RAG -->
  <path d="M330 295 L350 295" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  <path d="M630 295 L650 295" stroke="#4b5563" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Define arrowhead marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4b5563"/>
    </marker>
  </defs>
  
  <!-- Légende du flux de traitement -->
  <rect x="30" y="742" width="940" height="1" fill="#6b7280"/>
  
  <text x="500" y="735" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-style="italic" fill="#6b7280">
    Flux de traitement: Question utilisateur → Génération de requêtes alternatives → Récupération de documents → Enrichissement → Génération de réponse
  </text>
</svg>